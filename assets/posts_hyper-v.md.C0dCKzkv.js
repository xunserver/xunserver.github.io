import{_ as a,c as t,o,ah as l}from"./chunks/framework.BurO9VyR.js";const u=JSON.parse('{"title":"hyper-v","description":null,"frontmatter":{"title":"hyper-v","comments":true,"hide":false,"abbrlink":"320b54d3","date":"2020-11-22T21:20:03.000Z","updated":"2020-11-22T21:20:03.000Z","tags":null,"categories":null,"description":null},"headers":[],"relativePath":"posts/hyper-v.md","filePath":"posts/hyper-v.md"}'),i={name:"posts/hyper-v.md"};function n(r,e,c,s,d,h){return o(),t("div",null,e[0]||(e[0]=[l('<h2 id="下载固件" tabindex="-1">下载固件 <a class="header-anchor" href="#下载固件" aria-label="Permalink to &quot;下载固件&quot;">​</a></h2><p>下载<a href="https://firmware.koolshare.cn/LEDE_X64_fw867/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BD%AC%E7%9B%98%E6%88%96PE%E4%B8%8B%E5%86%99%E7%9B%98%E4%B8%93%E7%94%A8/" target="_blank" rel="noreferrer">lede 虚拟机专用固件</a>, 下载名称为<code>generic-squashfs-combined-efi.vmdk</code>的固件。</p><h2 id="转盘" tabindex="-1">转盘 <a class="header-anchor" href="#转盘" aria-label="Permalink to &quot;转盘&quot;">​</a></h2><p>使用转盘工具 <a href="http://www.pc6.com/softview/SoftView_809076.html" target="_blank" rel="noreferrer">StarWind Software V2V Image Converter</a>。转盘工具可以转换<code>.img</code> <code>.vmdk</code> <code>.vhd</code> <code>.vhdx</code>格式，将固件转换成 vhdx 格式镜像，或者并且支持动态动态扩展大小的格式。</p><h2 id="虚拟交换机配置" tabindex="-1">虚拟交换机配置 <a class="header-anchor" href="#虚拟交换机配置" aria-label="Permalink to &quot;虚拟交换机配置&quot;">​</a></h2><h3 id="配置-wan" tabindex="-1">配置 Wan <a class="header-anchor" href="#配置-wan" aria-label="Permalink to &quot;配置 Wan&quot;">​</a></h3><p>新建虚拟交换机 =&gt; 外部网络 =&gt; 选择需要绑定的网卡 =&gt; 取消允许管理操作系统共享此网络适配器</p><p>如果取消允许管理操作系统共享此网络适配器，宿主机不能通过此网卡上网，必须要通过内部 <code>lan =&gt; 软路由 =&gt; wan</code> , 共享情况下是直接 <code>=&gt; wan</code></p><p>如果需要多拨的，重复上述步骤</p><h2 id="配置-lan-x" tabindex="-1">配置 lan-x <a class="header-anchor" href="#配置-lan-x" aria-label="Permalink to &quot;配置 lan-x&quot;">​</a></h2><p>新建虚拟交换机 =&gt; 外部网络 =&gt; 选择需要绑定的网卡 =&gt; 取消允许管理操作系统共享此网络适配器</p><p>重复上述步骤添加其余 lan</p><h2 id="虚拟机配置" tabindex="-1">虚拟机配置 <a class="header-anchor" href="#虚拟机配置" aria-label="Permalink to &quot;虚拟机配置&quot;">​</a></h2><ol><li>虚拟机存储位置指的是虚拟机相关的配置保存路径，不是磁盘路径</li><li>虚拟机代数，已知 lede 可以用二代；高恪，爱快二代显示镜像未找到，暂无方法，只能用第一代，第二代可以用 efi 镜像</li><li>第一代第二代磁盘使用不一致，第二代只能用 scsi 控制器添加硬盘驱动器。</li><li>硬盘驱动器第一代选择 IDE 控制器 1</li><li>虚拟磁盘选择转盘后的文件，使用文件前，先扩容到 2G。虚拟磁盘理解成一个隔离的真实磁盘</li><li>网卡配置按照 内部网络 =&gt; lan =&gt; wan 口的形式配置。外部网络需要在高级设置中启动 mac 地址欺骗</li><li>取消安全性检查</li><li>bios 启动顺序，使用硬盘优先</li><li>最好禁用检查点</li></ol><h2 id="启动设备" tabindex="-1">启动设备 <a class="header-anchor" href="#启动设备" aria-label="Permalink to &quot;启动设备&quot;">​</a></h2><p>使用 192.168.1.1 访问软路由管理界面。因为添加了内部 lan，否则只能设置外部 lan 网卡的网关到 192.168.1.1</p><h2 id="直通教程" tabindex="-1">直通教程 <a class="header-anchor" href="#直通教程" aria-label="Permalink to &quot;直通教程&quot;">​</a></h2><ol><li>查看所有设备</li></ol><blockquote><p>Get-PnpDevice</p></blockquote><ol start="2"><li>获取 InstanceId</li></ol><blockquote><p>Get-PnpDevice -FriendlyName &quot;设备名称&quot;| select InstanceId</p></blockquote><ol start="3"><li>禁用设备</li></ol><blockquote><p>Disable-PnpDevice -InstanceId &quot;设备 InstanceId&quot;</p></blockquote><ol start="4"><li>获取设备 LocationPaths</li></ol><blockquote><p>Get-PnpDeviceProperty -InstanceId &quot;设备 InstanceId&quot; -KeyName DEVPKEY_Device_LocationPaths</p></blockquote><ol start="5"><li>通过 LocationPaths 下线设备</li></ol><blockquote><p>Dismount-VMHostAssignableDevice -Force -LocationPath &quot;设备 LocationPaths&quot;</p></blockquote><ol start="6"><li>查看被下线的设备</li></ol><blockquote><p>Get-VMHostAssignableDevice</p></blockquote><ol start="7"><li>通过 LocationPaths 添加设备到虚拟机</li></ol><blockquote><p>Add-VMAssignableDevice -VMName &quot;虚拟机名称&quot; -LocationPath &quot;设备 LocationPaths&quot;</p></blockquote><p>可以直接通过 设备管理器 =&gt; 设备 =&gt; 设备详细信息查看 <code>InstanceId</code> 和 <code>LocationPaths</code>。LocationPaths=位置路径 InstanceId=设备实例路径</p><h2 id="踩坑事项" tabindex="-1">踩坑事项 <a class="header-anchor" href="#踩坑事项" aria-label="Permalink to &quot;踩坑事项&quot;">​</a></h2><ul><li>外部网络不能并用，所以不能同一个外部网络不能分配到两个虚拟机上。</li><li>外部网络设备互斥，不能讲同一个设备分配到两个外部网络上。</li><li>出现 boot loader 加载失败，原因是没有禁用安全性启动</li><li>出现镜像未找到原因是，部分固件不支持二代虚拟机，需要用第一代的形式</li></ul>',34)]))}const q=a(i,[["render",n]]);export{u as __pageData,q as default};
